<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:meta="http://xml.zope.org/namespaces/meta"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      id="sessions"
      meta:interpolation="true"
      metal:use-macro="context/@@shell/macros/shell"
      tal:define="
        tools nocall:context/@@tools;
      "
      i18n:domain="euphorie"
>
  <body>
    <metal:slot fill-slot="content"
                tal:define="
                  language view/portal/plone_portal_state/language;
                  root view/get_sessions_tree_root;
                  my_context view/my_context;
                "
    >
      <tal:block replace="tile:statusmessages" />
      <form tal:condition="python:my_context=='country'"
            class="pat-inject pat-autosubmit"
            id="canvas-toolbar"
            action="${request/getURL}#sessions"
            tal:define="
              options view/scope_options;
            "
      >
        <label class="pat-select"
               tal:condition="view/scope_options"
        >
          <select name="scope">
            <option selected="${option/selected|nothing}"
                    value="${option/value}"
                    tal:repeat="option options"
            >${option/label}</option>
          </select>
        </label>
        <a class="pat-button float-after pat-modal icon-plus-circle"
           id="button-new-session"
           href="${here/absolute_url}/@@new-session.html#document-content"
           title="Start a new session"
           data-pat-modal="class: large"
           i18n:attributes="title"
           i18n:translate="link_start_session"
        >start a new session</a>
      </form>
      <article tal:condition="python:my_context=='survey'">
        <p i18n:translate="header_select_session">
            Select an earlier session to complete or review.
        </p>
      </article>
      <fieldset class="session-list"
                id="sessions"
      >
        <tal:node repeat="child root/groups">
          <metal:node define-macro="node">
            <fieldset class="${child/type}"
                      tal:condition="python:child.type == 'department'"
            >
              <legend class="${child/type}-name">${child/title}</legend>
              <tal:nodes repeat="child child/groups">
                <metal:node use-macro="template/macros/node" />
              </tal:nodes>
            </fieldset>
            <tal:survey tal:condition="python:child.type == 'tool'">
              <h3 class="${child/type}-name">${child/title}</h3>
              <ul class="sessions">
                <tal:session repeat="child child/sessions">
                  <li class="session"
                      tal:define="
                        session child/context;
                      "
                  >
                    <span class="name field">
                      <a href="${request/getURL}?action=continue&amp;session=${session/id}"
                        >${session/title}</a>,
                      <span class="last-saved">
                       <tal:i18n i18n:translate="">Last saved</tal:i18n>
                        <time class="pat-display-time"
                              datetime="${value}"
                              data-pat-display-time="from-now: true; locale: ${language}"
                              tal:define="value session/modified/isoformat|nothing;"
                        >${value}</time>
                      </span>
                    </span>
                    <span class="date field"
                          tal:condition="session/published"
                    >
                      <span class="label">
                        <tal:i18n i18n:translate="">Last published</tal:i18n>
                        <time class="pat-display-time"
                              datetime="${value}"
                              data-pat-display-time="from-now: true; locale: ${language}"
                              tal:define="value session/published/isoformat|nothing;"
                        >${value}</time>
                      </span>
                    </span>
                  </li>
                </tal:session>
              </ul>
            </tal:survey>
          </metal:node>
        </tal:node>
      </fieldset>
      <form tal:condition="python:my_context=='survey'"
            method="post">
        <article>
          <p>
            <tal:i18n i18n:translate="header_or">or&hellip;</tal:i18n>
            <a id="button-new-session"
               href="${here/absolute_url}/@@new-session.html?action=new#document-content"
               title="Start a new session"
               i18n:attributes="title"
               i18n:translate="link_start_session"
            >start a new session</a>
            with this tool.
          </p>
        </article>
      </form>

    </metal:slot>

    <metal:slot fill-slot="splash_message_slot">
      <div class="splash-message"
           tal:condition="python:splash_message is not None"
      >
        <hr class="trigger pat-switch"
            data-pat-switch="selector: body; remove: splash-on-motd*; add: splash-off-${splash_message/id}; store: local"
        />
        <article class="pat-rich content">
          <p>
            <img src="${base_url}/++resource++oira.media/oira-logo-colour.svg"
                 width="20%"
            />
          </p>
          <h1 tal:content="structure splash_message/title">Message of the day!</h1>
          <tal:content content="structure splash_message/text" />
        </article>
      </div>
    </metal:slot>

  </body>
</html>
